generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum ROLE {
  Customer
  Seller
  Admin
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  role      ROLE
  order Order[]
  cart Cart[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Product {
  id String @id @default(uuid())
  name String
  inventories Inventory[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum ORDER_ITEM_STATE{
  CREATED
  CONFIRMED
  PACKED
  SHIPPED
  DELIVERED
  CANCELED
  RETURNED
  REFUNDED

}
model Order {
  id        String    @id @default(uuid())
  customerId String
  customer User @relation(fields: [customerId],references: [id])
  orderItems OrderItem[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

}

model OrderItem {
  id         String  @id @default(uuid())
  quantity Int
  priceAtPurchase Int 
  orderId String
  order Order @relation(fields: [orderId],references: [id])
  productId String
  sellerId String
  status ORDER_ITEM_STATE
  return Return[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Cart {
  id String @id @default(uuid())
  cartItems CartItem[]
  customerId String
  customer User @relation(fields: [customerId],references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CartItem {
  id String @id @default(uuid())
  productId String
  cartId String
  cart Cart @relation(fields: [cartId],references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


//availableQty + reservedQty + soldQty must always equal total stock.
model Inventory {
  id String @id @default(uuid())
  productId String
  sellerId String
  availableQty Int
  soldQty Int
  reservedQty Int
  products Product @relation(fields: [productId],references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum SHIPMENT{
  Shipped
  Delivered
}
model Shipment {
  id String @id @default(ulid())
  shipmentItems ShipmentItem[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ShipmentItem {
  id String @id @default(uuid())
  orderItemId String
  shipmentId String
  shipment Shipment @relation(fields: [shipmentId],references: [id])
  status SHIPMENT
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum RETURN{
  Cancelled
  Return 
  Refund
}
model Return {
  id String @id @default(uuid())
  orderItemId String
  order OrderItem @relation(fields: [orderItemId],references: [id])
  status RETURN
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
